<html>
  <head><title>Upload File</title></head>
  <body>
    <div>
      Remote Directory: <input id="remote_directory" type="text" />
    </div>
    <div>
      Local File: <input id="l1" type="file" />
      Local File: <input id="l2" type="file" />
    </div>
    <div><button id="upload">Upload</button></div>
    <div id="log" style="background:#eee; height:10em; padding:0.5em;"></div>

    <script>
      //https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch

      function E(id) { return document.getElementById(id); }
      const directory = E('remote_directory');
      const upload = E('upload');
      const log = E('log');
      upload.onclick = function() {upload_file()};

      async function upload_file() {
        const files = document.querySelectorAll('input[type="file"]');
        console.log(files);

        const formdata = new FormData();
        let i = 0;
        for (const file of files) {
          formdata.append(`file_${i}`, file.files[0]);
          i += 1;
          console.log(`i = ${i}`);
        }

        const requestOptions = {
          method: 'POST',
          body: formdata,
          redirect: 'follow'
        };

        const response = await fetch(
          `/upload?directory=${directory.value}`, 
          requestOptions);
        console.log(response);
        if (response.status === 200) {
          log.innerHTML = 'Upload File Success.';
        } else {
          log.innerHTML = `Upload File Failed.<br/>${response}`;
        }

        //const data = await response.json();
        const data = await response.text();
        console.log(data);
      }
    </script>
  </body>
</html>
